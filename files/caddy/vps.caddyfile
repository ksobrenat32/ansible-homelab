# The Caddyfile is an easy way to configure your Caddy web server.
#
# https://caddyserver.com/docs/caddyfile

(botForbidden) {
    # Expanded list of known bad bots
    @knownBadBots header_regexp User-Agent "(?i)AdsBot-Google|Amazonbot|anthropic-ai|Applebot|Applebot-Extended|AwarioRssBot|AwarioSmartBot|Bytespider|CCBot|ChatGPT|ChatGPT-User|Claude-Web|ClaudeBot|cohere-ai|DataForSeoBot|Diffbot|FacebookBot|Google-Extended|GPTBot|ImagesiftBot|magpie-crawler|omgili|Omgilibot|peer39_crawler|PerplexityBot|YouBot|AhrefsBot|SemrushBot|MJ12bot|DotBot|PetalBot|BLEXBot|YandexBot|MegaIndex|ZoominfoBot|Barkrowler|MauiBot|Linguee Bot|serpstatbot|SEOkicks"

    # Match missing User-Agent header
    @missingUserAgent not header User-Agent *

    # Match empty User-Agent header (e.g., User-Agent: "")
    @emptyUserAgent header_regexp User-Agent "^$"

    # --- Handlers ---
    # If any of these match, respond with 403.
    # Caddy processes handlers in order. `close` stops further processing for the matched request.

    handle @knownBadBots {
        respond "Access Denied: Bot" 403 {
            close
        }
    }
    handle @missingUserAgent {
        respond "Access Denied: Missing User-Agent" 403 {
            close
        }
    }
    handle @emptyUserAgent {
        respond "Access Denied: Empty User-Agent" 403 {
            close
        }
    }
}

ks32.dev {
    root * /data/ks32.dev
    encode gzip
    file_server browse
    import botForbidden
}

# Scholarships-db
becas.ks32.dev {
	reverse_proxy 127.0.0.1:3000
	basic_auth {
		becas $2a$14$EQ4vjRHVFoQAkNW/nuQjMOXwwKsme4Yl0UGlQHne5.DKFTXjtByCi
	}
	import botForbidden
}
up.ks32.dev {
	reverse_proxy 127.0.0.1:3001
	import botForbidden
}

# Overleaf
overleaf.ks32.dev {
	reverse_proxy 127.0.0.1:3002
	import botForbidden
}

# Redlib
red.ks32.dev {
	reverse_proxy 127.0.0.1:3003
	import botForbidden
}

# Invidious
vid.ks32.dev {
	reverse_proxy 127.0.0.1:3004
	import botForbidden
}

# stirling-pdf
pdf.ks32.dev {
	reverse_proxy 127.0.0.1:3005
	import botForbidden
}
